<div id="books">
    <div v-if="errorMsg != ''" class="alert alert-danger">
        <div v-html="lng(errorMsg)"></div>
    </div>
    <div v-if="successMsg != ''" class="alert alert-success">
        <div v-html="lng(successMsg)"></div>
    </div>

    <div class="row">
		<div class="col-10">
			<h2 class="ribbon-banner"><span>{{ lng('BOOKS') }}</span></h2>
		</div>
		<div class="col-2">
			<a class="btn btn-primary" v-bind:href="HREF('book.setup',{})">
				<em class="fas fa-cog"></em></a>
		</div>		
	</div>

    <div class="row">
		<div class="col-12">
			<form class="filterForm form" id="filterForm" method="post" action="index.php">
				<img src="images/konyvtar.jpg" style="height:250px; float:right; margin:5px;" />
				<h4>{{ lng('SEARCH') }}</h4>
				<p>Egyszerre csak egy feltételt használj!</p>
				<input type="hidden" name="task" value="book.items" />
				<input type="hidden" name="page" value="1" />
				<label>{{ lng('TITLE') }}</label>
				<input type="text" name="filter_title" id="filter_title" class="form-control"/>
				<br />
				<label>{{ lng('AUTHOR') }}</label>
				<input type="text" name="filter_author" id="filter_author" class="form-control"/>
				<br />
				<label>{{ lng('CATEGORY') }}</label>
				<select name="filter_category" id="filter_category" class="form-control">
					<option value=""></option>
					<option v-for="category in categories" v-bind:value="category.id">{{ category.category_name }}</option>
				</select>
				<br />
				<label>{{ lng('STORAGE') }}</label>
				<select name="filter_storage" id="filter_storage" class="form-control">
					<option value=""></option>
					<option v-for="storage in storages" v-bind:value="storage.id">{{ storage.storage_name }}</option>
				</select>
				<button type="submit" class="btn btn-primary" v-bind:title="lng('SEARCH')">
					<em class="fas fa-search"></em>
				</button>
				<button type="button" class="btn btn-secondary" v-on:click="delSearchClick()">
					<em class="fas fa-times"></em>
				</button>
			</form>
		</div>
	</div>
    <div class="row" v-if="logedAdmin">
		<div class="col-12">
			<a class="btn btn-primary" v-bind:href="HREF('book.new',{})">
				<em class="fas fa-plus"></em><span>{{ lng('ADD') }}</span></a>
		</div>
    </div>
    <div class="row">
		<table class="col-12 table table-bordered table-striped" style="width:100%" v-if="items.length > 0">
			<tr><th style="width:30px">ID</th>
				<th>{{ lng('AUTHORS') }}</th>
				<th>{{ lng('TITLE') }}</th>
				<th>{{ lng('STORAGE') }}</th>
				<th></th>
			</tr>
			<tr v-for="item in items">
				<td>{{ item.id }}</td>
				<td> <a v-bind:href="HREF('book.showform',{id:item.id, backtask:'book.items'})">
					{{ item.authors }}
				 </a>
				</td>    
				<td> <a v-bind:href="HREF('book.showform',{id:item.id, backtask:'book.items'})">
					{{ item.title }}
				 </a>
				</td>    
				<td>
					{{ item.storage_name }}
				</td>
				<td>
					<a class="btn btn-primary"  v-bind:href="HREF('book.showform',{id:item.id, backtask:'book.items'})">
						<em class="fas fa-eye" v-bind:title="lng('SHOW')"></em>
					</a>
					<a class="btn btn-primary"  v-if="logedAdmin"v-bind:href="HREF('book.editform',{id:item.id, backtask:'book.items'})">
						<em class="fas fa-edit" v-bind:title="lng('EDIT')"></em>
					</a>
					<button type="button" class="btn btn-danger" v-if="logedAdmin" v-on:click="delClick(item.id)">
						<em class="fas fa-eraser" v-bind:title="lng('DELETE')"></em>
					</button>
				</td> 
			</tr>
		</table>
    </div>
    <div class="alert alert-info col-12" v-if="items.length == 0">{{ lng('NOT_ITEMS') }}</div>
    <div v-if="items.length > 0">
		include paginator
    </div>
    <div class="row" v-if="logedAdmin">
		<div class="col-12">
			<a class="btn btn-primary" v-bind:href="HREF('book.new',{})">
				<em class="fas fa-plus"></em><span>{{ lng('ADD') }}</span></a>
		</div>
    </div>
</div>

<script>
    methods = {
		afterMount() {
			if (this.filter != undefined) {
				// filter strintg (name|value....)  to filterForm
				if (this.filter != '') {
					var filter = this.filter.split('|');
					var i = 0;
					var fn = '';
					while (i < filter.length) {
						fn = filter[i];
						document.getElementById('filter_'+fn).value = filter[i+1];
						i = i + 2;
					}
				}
			}
		},
        makePaginatorClass(p,page) {
            var result = '';
            if (p == page) {
                result="actPaginatorItem";
            } else {
                result="paginatorItem"
            }
            return result;
        },
        delClick(id) {
            popupConfirm(lng('SUREDELETE'), 
            function() {
                location=HREF('book.delete',{'id':id, key:app.flowKey}); 
            })
        },
        delSearchClick() {
			document.getElementById('filter_title').value = '';
			document.getElementById('filter_author').value = '';
			$('#filter_category').val('');
			$('#filter_storage').val('');
			document.getElementById('filterForm').submit();
		}    
        
    }
</script>
