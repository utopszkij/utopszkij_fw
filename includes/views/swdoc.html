<style type="text/css">
	pre {background-color:silver; line-height:18px; padding:10px;}
</style>
<h1>Utopszkij_fw keretrendszer program dokumentáció</h1>
<div id="Tartalomjegyzék1" dir="ltr">
	<div id="Tartalomjegyzék1_Head" dir="ltr"><p style="margin-top: 0.42cm; margin-bottom: 0.21cm; background: transparent; line-height: 100%; page-break-after: avoid">
		<font face="Liberation Sans, sans-serif"><font size="4" style="font-size: 16pt"><b>Tartalomjegyzék</b></font></font></p>
	</div>
	<p style="margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc145_953040041">Utopszkij_fw keretrendszer
	program dokumentáció	</a></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc147_953040041">1. Általános
	áttekintés	</a></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc149_953040041">1.1. Adatbázis
	interfész	</a></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc151_953040041">1.2. Lekérdezések	</a></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc153_953040041">1.2.1. Egy táblát
	érintő adatbázis lekérdezés	</a></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc155_953040041">1.2.2. Join -al
	összekapcsolt táblákat érintő adatbázis lekérdezés	</a></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc157_953040041">1.2.3. Union -al
	összekapcsolt lekérdezés	</a></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc159_953040041">1.3. Adatbázis
	manipulációk	</a></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc161_953040041">1.3.1 Record felvitel	</a></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc163_953040041">1.3.2 Record(ok)
	módosítása	</a></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc165_953040041">1.3.3 Record(ok)
	törlése	</a></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc167_953040041">1.4. SQL script
	futtatás	</a></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc169_953040041">1.5. Hibakezelés	</a></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc171_953040041">2. MVC struktúra	</a></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc173_953040041">2.1. Controller	</a></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc175_953040041">2.2. Model	</a></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc177_953040041">2.3. Viewer	</a></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc179_953040041">2.3.1 paginátor	</a></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc181_953040041">3. Taskok	</a></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc183_953040041">3.1 SEO barát URL -ek	</a></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc185_953040041">4. Megjelenés (css)	</a></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___Toc187_953040041">5. Új verzió	publikálás	</a></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm; background: transparent; line-height: 100%">
	<a href="index.php?task=home.swdoc#__RefHeading___multilanguage">6. Több nyelvüség</a></p>
	</div>
<h2><br/>
<br/>

</h2>
<h2><a name="__RefHeading___Toc147_953040041"></a><a name="1ltalnosttekints"></a><a name="__RefHeading___Toc128_1001536460"></a>
1. Általános áttekintés</h2>
<p>Az Utopszkij_fw egy általános célra készült PHP-MYSQL-VUE
keretrendszer. A laravel-nél kisebb erőforrás igényű,
egyszerűbben telepíthető, ennek ellenére annak sok szolgáltatását
nyújtja, szintaxisa több ponton hasonló ahhoz. Így aki a laravel-t
ismeri az könnyen megbarátkozik ezzel is, de a laravel ismerete
nélkül is boldogulni fogsz vele. A keretredszer Model – Viewer –
Controller struktúra szerint épül fel (MVC). A mysql elérés egy
egyedi, laravel -re emlékeztető interfészen keresztül történik.
A web oldalak megjelenítéséhez vuejs -t és bootstrap -ot használ.</p>
<p>Php class -ok dokumentációja: <a href="doc/html/index.html">doc/html/index.html</a>
</p>
<h3><a name="__RefHeading___Toc149_953040041"></a><a name="11adatbzisinterfsz"></a><a name="__RefHeading___Toc130_1001536460"></a>
1.1. Adatbázis interfész</h3>
<p>Az index.php gondoskodik a betöltéséről
(vendor/database/db.php) Alap objektuma: <strong>Query(„tableName”)</strong>.
</p>
<p>Az interface feltételezei, hogy a rekordokban van egy integer
<strong>&quot;id&quot;</strong> ami a <strong>primary key</strong> és
<strong>auto increment</strong>. A használatot példákon keresztül
szemléltetjük.</p>
<h3><br/>
<br/>

</h3>
<h3 style="page-break-before: always"><a name="__RefHeading___Toc151_953040041"></a><a name="__RefHeading___Toc132_1001536460"></a><a name="12lekrdezsek"></a>
1.2. Lekérdezések</h3>
<h4><a name="__RefHeading___Toc153_953040041"></a><a name="__RefHeading___Toc134_1001536460"></a><a name="121egytbltrintadatbzislekrdezs"></a>
1.2.1. Egy táblát érintő adatbázis lekérdezés</h4>
<pre> 
$db = new Query(&quot;tableName&quot;);
$record = $db-&gt;where(&quot;name&quot;,”=”,”valaki”)
    -&gt;where(&quot;state&quot;,&quot;&gt;&quot;,1)
        -&gt;first();  
 // result = {&quot;colName&quot;:colValue, ....} vagy {}  

 $state = 7;  
 $records = $db-&gt;select([&quot;name&quot;,[&quot;state&quot;,&quot;s&quot;], [&quot;sum(adat)&quot;,&quot;sadat&quot;]])  
                -&gt;where(&quot;name&quot;,&quot;&lt;&gt;&quot;,&quot;&quot;)  
                -&gt;orWhere(&quot;state&quot;,&quot;=&quot;,$state)  
                -&gt;groupBy([&quot;id&quot;,&quot;name&quot;,&quot;state&quot;])  
                -&gt;orderBy(&quot;name&quot;)  
                -&gt;offset(12)  
                -&gt;limit(20)  
                -&gt;all();  
 // result = [{&quot;name&quot;:&quot;...&quot;, &quot;s&quot;:&quot;...&quot;, &quot;sadat&quot;:szám},...] vagy []  

 $count = $db-&gt;where(&quot;name&quot;,&quot;=&quot;,&quot;Gipsz&quot;)  
            -&gt;count();  
 // result : integer rekordok száma  </pre><h4>
<a name="__RefHeading___Toc155_953040041"></a><a name="__RefHeading___Toc136_1001536460"></a><a name="122joinalsszekapcsolttblkatrintadatbzislekrdezs"></a>
1.2.2. Join -al összekapcsolt táblákat érintő adatbázis
lekérdezés</h4>
<pre> $db = new Query(&quot;table1&quot;,&quot;t1&quot;);  
 $records = $db-&gt;select([&quot;t1.id&quot;,&quot;t2.name&quot;])  
            -&gt;join(&quot;LEFT OUTER&quot;,&quot;table2&quot;,&quot;t2&quot;,&quot;t2.id&quot;,&quot;=&quot;,&quot;t1.id&quot;)  
            -&gt;where(&quot;t1.id&quot;,&quot;&gt;=&quot;,11)  
            -&gt;all();  </pre><h4>
<a name="__RefHeading___Toc157_953040041"></a><a name="123unionalsszekapcsoltlekrdezs"></a><a name="__RefHeading___Toc138_1001536460"></a>
1.2.3. Union -al összekapcsolt lekérdezés</h4>
<pre> $db1 = new Query(&quot;table1&quot;);  
 $db1-&gt;select([&quot;id&quot;,&quot;name&quot;])  

 $db2 = new Query(&quot;table2&quot;);  
 $records = $db2-&gt;select([&quot;id&quot;,&quot;name&quot;])  
                -&gt;where(&quot;id&quot;,&quot;&lt;&quot;,20)  
                -&gt;union($db1)  
                -&gt;orderBy(&quot;nev&quot;)  
                -&gt;all();    </pre><h3>
<a name="__RefHeading___Toc159_953040041"></a><a name="__RefHeading___Toc140_1001536460"></a><a name="13adatbzismanipulcik"></a>
1.3. Adatbázis manipulációk</h3>
<h4><a name="__RefHeading___Toc161_953040041"></a><a name="__RefHeading___Toc142_1001536460"></a><a name="131recordfelvitel"></a>
1.3.1 Record felvitel</h4>
<pre> $record = new Record();  
 $record-&gt;id = 0;  
 $record-&gt;name = &quot;nev1&quot;;  
 $db = new Query(&quot;tabla1&quot;);  
 $newId = $db-&gt;insert($record);  // id autoinc primary key)  </pre><h4>
<a name="__RefHeading___Toc163_953040041"></a><a name="__RefHeading___Toc144_1001536460"></a><a name="132recordokmdostsa"></a>
1.3.2 Record(ok) módosítása</h4>
<pre> $record = new Record();  
 $record-&gt;name = &quot;nev1-modositva&quot;;  
 $db = new Query(&quot;tabla1&quot;);  
 $bool = $db-&gt;where(&quot;state&quot;,&quot;=&quot;,3)  
        -&gt;update($record);    </pre><h4>
<a name="__RefHeading___Toc165_953040041"></a><a name="__RefHeading___Toc146_1001536460"></a><a name="133recordoktrlse"></a>
1.3.3 Record(ok) törlése</h4>
<pre> $db = new Query(&quot;tabla1&quot;);  
 $bool = $db-&gt;where(&quot;state&quot;,&quot;=&quot;,3)  
        -&gt;delete();    </pre><h3>
<a name="__RefHeading___Toc167_953040041"></a><a name="__RefHeading___Toc148_1001536460"></a><a name="14sqlscriptfuttats"></a>
1.4. SQL script futtatás</h3>
<pre> $db = new Query(&quot;tabla1&quot;);  
 $db-&gt;exec(&quot;sql script&quot;);    </pre><h3>
<a name="__RefHeading___Toc169_953040041"></a><a name="__RefHeading___Toc150_1001536460"></a><a name="15hibakezels"></a>
1.5. Hibakezelés</h3>
<p>Minden hívás után ellenőrizhető a <strong>$db-&gt;error</strong>
public property. Ha ez &quot;&quot; akkor nem volt hiba, ellenkező
esetben a hibaüzenetet tartalmazza.</p>
<h2><a name="__RefHeading___Toc171_953040041"></a><a name="__RefHeading___Toc152_1001536460"></a><a name="2mvcstruktra"></a>
2. MVC struktúra</h2>
<p>Adat modellek: includes/models/{modelName}model.php</p>
<p>Viewerek: includes/views/{viewName}.html</p>
<p>Controllerek: includes/controllers/{conrollerName}.php</p>
<h3><a name="__RefHeading___Toc173_953040041"></a><a name="__RefHeading___Toc154_1001536460"></a><a name="21controller"></a>
2.1. Controller</h3>
<pre> &lt;?php  
 use \RATWEB\DB\Query;  
 use \RATWEB\DB\Record;  

 include_once __DIR__.'/../models/valamimodel.php';  
 class Valami extends Controller {  

        function __construct() {  
            parent::__construct();  
            $this-&gt;name = &quot;valami&quot;;  
            $this-&gt;model = new ValamiModel();  
            $this-&gt;browserURL = 'index.php?task=valamik';  
            $this-&gt;addURL = 'index.php?task=valamiadd';  
            $this-&gt;editURL = 'index.php?task=valamiedit';  
            $this-&gt;browserTask = 'valamik';  
        }  

        /**  
         * rekord ellenörzés  
         * @param Record $record  
         * @return string üres vagy hibaüzenet  
         */  
        protected function validator($record):string {  
            $result = '';  
            .....  
            return $result;  
        }  

        /**  
         * bejelentkezett user jogosult erre?  
         * @param string $action new|edit|delete|show  
         * @return bool  
         */  
        protected function  accessRight(string $action, $record):bool {  
	            $result = false;  
	            ....  
	            return $result;  
	        }  
	
 
    /**
	* Bejelentkezés kieröltetése
    * string $act 'task/taskname[/parName/parValue....]'
    */
    protected function  mustLogin(string $act)
  <br />
        public function task1() {  
            ....  
        }  

        ....  
 }  
 ?&gt;  </pre><p>
lásd a vendor/controller.php -t is!</p>
<h3><a name="__RefHeading___Toc175_953040041"></a><a name="__RefHeading___Toc156_1001536460"></a><a name="22model"></a>
2.2. Model</h3>
<pre> &lt;?php  
        use \RATWEB\Model;  
        use \RATWEB\DB\Query;  
        use \RATWEB\DB\Record;  

        class ValamiModel extends Model  {  

            function __construct() {  
                parent::__construct();  
                $this-&gt;setTable = 'valami';  
                $this-&gt;errorMsg = '';   
            }  

            // ha böngésző is van akkor kell  definiálni  
            // getItems(int $page, int $limit,$filter,int $order):array;  
            // getTotal($filter): int;   
            // public metodusokat is  

        }          

 ?&gt;  </pre><p>
Lásd a vendor/model.php -t is!</p>
<h3><a name="__RefHeading___Toc177_953040041"></a><a name="__RefHeading___Toc158_1001536460"></a><a name="23viewer"></a>
2.3. Viewer</h3>
<p>A viewer hívása a controllerben:</p>
<pre>        view(&quot;viewName&quot;,  
            [&quot;par1&quot;:value1, ....],  
            &quot;appname&quot;)  </pre><p>
A harmadik paraméter elmaradhat, ez esetben &quot;app&quot; az
alapértelmezése.</p>
<p>A html outputon egy 
</p>
<pre> &lt;div id=&quot;appName&quot;&gt;...&lt;/div&gt;   </pre><p>
fogja tartalmazni a html templatet, és generálva lesz a vuejs hívás
a megadott paramétereket átadva.</p>
<p>A viewer fájlok formája:</p>
<pre> &lt;div&gt;  
 .... vue elemeket is tartalmazhat,   
 include&nbsp;viewName sorokat is tartalmazhat  
 .....  
 &lt;/div&gt;  
 &lt;script&gt;  
        var methods = {  
            afterMount() {  
            },  
            .....  
        }  
 &lt;/script&gt;  </pre><p>
Lásd a vendor/view.php -t is!</p>
<p>Ha létezik a <strong>views</strong> könyvtárban <strong>{viewName}_{lng}.html</strong> akkor ezt használja,
	 ha nem akkor a <strong>{viewName}.html</strong> -t.</p>
<h3><a name="__RefHeading___Toc179_953040041"></a><a name="__RefHeading___Toc160_1001536460"></a><a name="231pagintor"></a>
2.3.1 paginátor</h3>
<p>A template -be a 
</p>
<pre> include paginator  </pre><p>
sort kell elhelyezni és a controllerben a viewer-nek át kell adni a <strong>
total</strong> (összes rekord szám), <strong>pages</strong> ([1,2,3...] a
teljes megjelenítéshet szükséges lapok felsorolása), <strong>limit</strong>
( az egy lapon megjelenített sorok száma), <strong>page</strong> (az éppen
megjelenített lap száma), <strong>task</strong> (a browser hívás task
neve) - paramétereket.</p>
<h2><a name="__RefHeading___Toc181_953040041"></a><a name="__RefHeading___Toc162_1001536460"></a><a name="3taskok"></a>
3. Taskok</h2>
<p>A taskok hívása az URL -be írt &quot;task=” paraméterrel
történik. Két módszer támogatott:</p>
<p>a. task=controllerName.taskName</p>
<p>b. task=taskName</p>
<p>A „b” eljárás használata esetén a komponenseket az
index.php -ban</p>
<pre> include_once('vendor/fw.php');  
 importComponent(„componentName”);   
 ....  </pre><p>
módon importálni kell, és a task neveknek az összes komponenst
tekintetve egyedieknek kell lenniük. A taskok a controllerek public
methodusai.</p>
<h3><a name="__RefHeading___Toc183_953040041"></a><a name="__RefHeading___Toc164_1001536460"></a><a name="31seobarturlek"></a>
3.1 SEO barát URL -ek</h3>
<p>Ha a .htaccess kezelés és a RewriteEngine a szerveren
engedélyezett akkor SEO barát URL -ek is használhatóak:</p>
<pre> http[s]://domain/path/task/taskName/parName1/parValue1/parName2/parValue2.....  
 például:  
 https://example.hu/task/recept.show/id/13  </pre><h2>
<a name="__RefHeading___Toc185_953040041"></a><a name="__RefHeading___Toc166_1001536460"></a><a name="4megjelenscss"></a>
4. Megjelenés (css)</h2>
<p>A documentRoot/style.css -el lehet a dizájnt kialakítani. A task
outputja</p>
<pre> &lt;div id=&quot;page&quot;&gt;...&lt;/div&gt;  </pre><p>
-ben jelenik meg a html -ben.</p>
<h2><a name="__RefHeading___Toc187_953040041"></a>5. Új verzió publikálás</h2>
<p><br/>
<br/>
</p>
<p>1. Az index.php -ban módositsuk a <strong>$fileVerzio</strong> adatot!</p>
<p>2. A <strong>readme.md</strong> fájlban modosítsuk a változás történet részt!</p>
<p>3. Szükség esetén az <strong>includes/controllers/upgrade.php</strong> fájlba készitsük el az adatbázist modosító kódot!</p>
<p>5. linux terminálban:</p>
<pre>cd {documentroot}
./tools/documentor.sh
./tools/files.sh
git checkout -b v#.#.#
git add .
git commit
git push origin v#.#.#
</pre>
<h2><a name="__RefHeading___multilanguage"></a>6. Több nyelvüség</h2>
<p>A config.php -ban szerepeljen egy <strong>define("LNG","lngCode");</strong> sor. </p>
<p>Létezzen  a languages/lngCode.js a következő tartalommal:</p>
<pre>
	tokens = {
		"token1":"szöveg1",
		"token2":"szöveg2",
		....
	};
</pre>  
<p>Létezhet languages/compName_lngCode.js fájl is:</p>
<pre>
	tokensComp = {
		"token1":"szöveg1",
		"token2":"szöveg2",
		....
	};
</pre>  
<p>A viewerekben a szövegek  <strong>lng("token")</strong> formában szerepeljenek.</p>
<p>A "token" formája lehet: <strong>token1&lt;br&gt;token2...</strong> is. 
	Ilyenkor a forditás a &lt;br&gt; -el szeparált szegmensenként külön-külön történik.</p>
